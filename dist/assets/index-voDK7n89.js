var Ie=Object.defineProperty;var Oe=(h,e,s)=>e in h?Ie(h,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[e]=s;var K=(h,e,s)=>(Oe(h,typeof e!="symbol"?e+"":e,s),s),xe=(h,e,s)=>{if(!e.has(h))throw TypeError("Cannot "+s)};var t=(h,e,s)=>(xe(h,e,"read from private field"),s?s.call(h):e.get(h)),r=(h,e,s)=>{if(e.has(h))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(h):e.set(h,s)},i=(h,e,s,n)=>(xe(h,e,"write to private field"),n?n.call(h,s):e.set(h,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();let ve;var f,M,x,T,ae,w,yt,Pt,gt,H,bt,vt,kt,D,R,wt,we;class Ae{constructor(e,s,n,o,a,l,u,d,c,m,B,C,E,_,q,Jt){K(this,"zoomYLevel",.2222);K(this,"zoomXLevel",0);r(this,f,void 0);r(this,M,void 0);r(this,x,void 0);r(this,T,void 0);r(this,ae,void 0);r(this,w,void 0);r(this,yt,void 0);r(this,Pt,!1);r(this,gt,void 0);r(this,H,!0);r(this,bt,void 0);r(this,vt,!0);r(this,kt,!0);r(this,D,!1);r(this,R,!1);r(this,wt,!1);r(this,we,!1);i(this,f,new Be(this,e,s,n,o)),i(this,M,new qe(this,a,l,u,d)),i(this,x,new Ne(this,c,m,B,C)),i(this,T,new Ve(this,E,_,q,Jt)),document.querySelectorAll("#top-nav button").forEach(y=>{y.addEventListener("click",(function(g){const k=g.target;k.id==="tf1m"||k.id==="tf3m"||k.id==="tf5m"||k.id==="tf15m"||(k.classList.toggle("disabled"),k.id==="cvdToggleBtn"?(i(this,vt,!t(this,vt)),t(this,T).toggleIndicator("cvd",t(this,vt))):k.id==="oiToggleBtn"&&(i(this,kt,!t(this,kt)),t(this,T).toggleIndicator("oi",t(this,kt))),!t(this,vt)&&!t(this,kt)?(document.querySelector("#canvas4").style.display="none",document.querySelector("#canvas1").style.height="90%",document.querySelector("#canvas2").style.height="90%",document.querySelector("#canvas3").style.height="10%",document.querySelector("#canvas3").style.top="90%"):(document.querySelector("#canvas4").style.display="flex",document.querySelector("#canvas1").style.height="80%",document.querySelector("#canvas2").style.height="80%",document.querySelector("#canvas3").style.height="10%",document.querySelector("#canvas3").style.top="90%"))}).bind(this))}),i(this,bt,document.querySelector("#btn2")),t(this,bt).addEventListener("click",y=>{i(this,H,!t(this,H)),this.updateScaleBtn()});const Me=document.querySelector("#ticksize-select");Me.addEventListener("change",y=>{const g=t(this,ae)*Me.value;console.log("new tick size:",g),t(this,f).bucketSize=g,t(this,f).maxQuantity=20,t(this,M).bucketSize=g}),t(this,f).canvas.addEventListener("mousedown",y=>{i(this,Pt,!0),i(this,gt,{x:y.clientX,y:y.clientY})}),t(this,f).canvas.addEventListener("mousemove",y=>{if(t(this,Pt)){i(this,H,!1);let g={x:y.clientX,y:y.clientY},k=g.x-t(this,gt).x,ce=g.y-t(this,gt).y;!t(this,D)&&t(this,R)&&(i(this,D,!0),requestAnimationFrame(()=>{t(this,f).panXY(k,ce),t(this,M).panY(ce),t(this,x).panX(k),t(this,T).panX(k),t(this,f).updateData(t(this,w),[]),t(this,M).updateData(t(this,w),t(this,yt)),t(this,x).updateData(t(this,w)),t(this,T).updateData(t(this,w),[]),i(this,D,!1)})),i(this,gt,g),this.updateScaleBtn()}}),["mouseup","mouseleave"].forEach(y=>t(this,f).canvas.addEventListener(y,()=>i(this,Pt,!1))),t(this,f).canvas.addEventListener("wheel",y=>{y.preventDefault(),i(this,H,!1);const g=5e-4/(.01-.001);let k=this.zoomYLevel-(y.deltaY>0?-g:g),ce=this.zoomXLevel+(y.deltaY>0?-g:g);this.zoomYLevel=Math.max(0,Math.min(k,1)),this.zoomXLevel=Math.max(0,Math.min(ce,1)),!t(this,D)&&t(this,R)&&(i(this,D,!0),requestAnimationFrame(()=>{t(this,f).zoomY(this.zoomYLevel),t(this,f).zoomX(this.zoomXLevel),t(this,M).zoomY(this.zoomYLevel),t(this,x).zoomX(this.zoomXLevel),t(this,T).zoomX(this.zoomXLevel),t(this,f).updateData(t(this,w),[]),t(this,M).updateData(t(this,w),t(this,yt)),t(this,x).updateData(t(this,w)),t(this,T).updateData(t(this,w),[]),i(this,D,!1)}),this.updateScaleBtn())}),t(this,M).canvas.addEventListener("wheel",y=>{y.preventDefault(),i(this,H,!1);const g=5e-4/(.01-.001);let k=this.zoomYLevel-(y.deltaY>0?-g:g);this.zoomYLevel=Math.max(0,Math.min(k,1)),!t(this,D)&&t(this,R)&&(i(this,D,!0),requestAnimationFrame(()=>{t(this,f).zoomY(this.zoomYLevel),t(this,M).zoomY(this.zoomYLevel),t(this,f).updateData(t(this,w),[]),t(this,M).updateData(t(this,w),t(this,yt)),i(this,D,!1)}),this.updateScaleBtn())}),t(this,x).canvas.addEventListener("wheel",y=>{y.preventDefault(),i(this,H,!1);const g=5e-4/(.01-.001);let k=this.zoomXLevel+(y.deltaY>0?-g:g);this.zoomXLevel=Math.max(0,Math.min(k,1)),!t(this,D)&&t(this,R)&&(i(this,D,!0),requestAnimationFrame(()=>{t(this,f).zoomX(this.zoomXLevel),t(this,x).zoomX(this.zoomXLevel),t(this,T).zoomX(this.zoomXLevel),t(this,f).updateData(t(this,w),[]),t(this,x).updateData(t(this,w)),t(this,T).updateData(t(this,w),[]),i(this,D,!1)})),this.updateScaleBtn()})}async fetchHistKlines(e,s,n,o,a){i(this,wt,!0);try{return await(await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${e}&interval=${s}${n?"&startTime="+n:""}${o?"&endTime="+o:""}&limit=${a}`)).json()}catch(l){return console.log(l,e),NaN}}async fetchHistTrades(e,s,n,o){let a=[];try{return a=(await(await fetch(`https://fapi.binance.com/fapi/v1/aggTrades=${e}startTime=${s}&endTime=${n}limit=${o}`)).json()).map(d=>({x:d.T,y:parseFloat(d.p),q:parseFloat(d.q),m:d.m})),a}catch(l){return console.log(l,e),NaN}}async getHistKlines(e,s,n){if(t(this,wt)){console.log("already fetching historical klines...");return}i(this,wt,!0),this.fetchHistKlines(ve,"1m",e,s,n).then(o=>{t(this,f).resolveHistData("klines",o),t(this,x).resolveHistData("klines",o),i(this,wt,!1)})}updateScaleBtn(){t(this,H)?(t(this,f).resetZoomAndPan(),t(this,M).resetZoomAndPan(),t(this,x).resetZoomAndPan(),t(this,T).resetZoomAndPan(),t(this,bt).innerHTML='<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 448 512"><path fill="#c8c8c8" d="M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"/></svg>'):t(this,bt).innerHTML='<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512"><path fill="#c8c8c8" d="M352 144c0-44.2 35.8-80 80-80s80 35.8 80 80v48c0 17.7 14.3 32 32 32s32-14.3 32-32V144C576 64.5 511.5 0 432 0S288 64.5 288 144v48H64c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V256c0-35.3-28.7-64-64-64H352V144z"/></svg>'}updateData(e){i(this,w,e.kline),i(this,yt,e.depth),t(this,f).updateData(e.kline,e.tradesBuffer),t(this,M).updateData(e.kline,e.depth),t(this,x).updateData(e.kline),t(this,T).updateData(e.kline,e.tradesBuffer)}startNew(e,s){i(this,R,!1),i(this,H,!0),this.updateScaleBtn(),t(this,f).resetData(),t(this,M).resetData(),t(this,x).resetData(),t(this,T).resetData(),this.zoomYLevel=.2222,this.zoomXLevel=0,ve=e,i(this,ae,s),t(this,R)||setTimeout(()=>{i(this,R,!0)},3e3)}}f=new WeakMap,M=new WeakMap,x=new WeakMap,T=new WeakMap,ae=new WeakMap,w=new WeakMap,yt=new WeakMap,Pt=new WeakMap,gt=new WeakMap,H=new WeakMap,bt=new WeakMap,vt=new WeakMap,kt=new WeakMap,D=new WeakMap,R=new WeakMap,wt=new WeakMap,we=new WeakMap;var he,p,G,N,J,St,U,ot,de,V,_t,It,S,Ot,At,at,Bt,W,ut,Mt,xt,qt;class Be{constructor(e,s,n,o,a){r(this,he,void 0);r(this,p,void 0);r(this,G,void 0);r(this,N,void 0);r(this,J,[]);r(this,St,[]);r(this,U,void 0);r(this,ot,[]);r(this,de,void 0);r(this,V,void 0);r(this,_t,void 0);r(this,It,60);r(this,S,void 0);r(this,Ot,.997);r(this,At,1.003);r(this,at,30);K(this,"bucketSize");r(this,Bt,!0);r(this,W,0);r(this,ut,0);r(this,Mt,null);r(this,xt,[]);r(this,qt,!1);i(this,he,e),i(this,p,s),this.canvas=n,i(this,G,o),i(this,N,a),i(this,S,Math.round(1*60*1e3/(30*60*1e3)*(t(this,G)-t(this,It)))),this.tradesDrawType=0,this.maxQuantity=20}panXY(e,s){i(this,Bt,!1);const n=t(this,N)/(t(this,_t)-t(this,V)),o=s/n;i(this,ut,t(this,ut)+o),i(this,W,t(this,W)+e<0?0:t(this,W)+e)}zoomY(e){const l=.001+.009000000000000001*e,u=.001+(.01-.001)*e;i(this,Ot,Math.round((1-l)*1e4)/1e4),i(this,At,Math.round((1+u)*1e4)/1e4)}zoomX(e){i(this,at,30+-20*e),i(this,S,Math.round(1*60*1e3/(t(this,at)*60*1e3)*(t(this,G)-t(this,It))))}resetZoomAndPan(){i(this,Bt,!0),i(this,W,0),i(this,ut,0),i(this,Ot,.997),i(this,At,1.003),i(this,at,30),i(this,S,Math.round(1*60*1e3/(t(this,at)*60*1e3)*(t(this,G)-t(this,It))))}resetData(){i(this,J,[]),i(this,St,[]),i(this,U,null),i(this,ot,[]),i(this,de,null),i(this,V,null),i(this,_t,null),i(this,Bt,!0),i(this,W,0),i(this,ut,0),i(this,Mt,null),i(this,qt,!1)}resolveHistData(e,s){e==="klines"&&(i(this,qt,!0),s.forEach(n=>{const[o,a,l,u,d,,c]=n,m={startTime:o,openPrice:a,highPrice:l,lowPrice:u,closePrice:d,endTime:c};t(this,J).unshift(m),t(this,St).unshift([])}))}updateData(e,s){const{E:n,k:{t:o,o:a,h:l,l:u,c:d,T:c}}=e;(n>t(this,Mt)||t(this,Mt)===null)&&(t(this,U)&&t(this,U).endTime!==c&&(t(this,J).push(t(this,U)),t(this,St).push(t(this,ot)),i(this,ot,[])),i(this,Mt,c)),i(this,U,{startTime:o,openPrice:a,highPrice:l,lowPrice:u,closePrice:d,endTime:c});for(let m=0;m<s.length;m++){const B=s[m];if(B.x>=o&&B.x<c)t(this,ot).push(B);else if(B.x>=c){t(this,xt).push(...s.slice(m));break}}t(this,xt).length>0&&i(this,xt,t(this,xt).filter(m=>m.x>=o&&m.x<c?(t(this,ot).push(m),!1):!0)),i(this,V,Math.min((Number(l)+Number(u))/2*t(this,Ot),u)+t(this,ut)),i(this,_t,Math.max((Number(l)+Number(u))/2*t(this,At),l)+t(this,ut)),this.drawStart()}drawStart(){t(this,p).clearRect(0,0,t(this,G),t(this,N));const e=t(this,U).startTime-t(this,at)*60*1e3+t(this,W);if(t(this,J).length>0&&t(this,J).forEach((s,n)=>{const o=t(this,St)[n],a=Math.round((s.startTime-e)/(t(this,at)*60*1e3)*(t(this,G)-t(this,S)));this.drawDataPoint(o,s,a+t(this,W))}),this.drawDataPoint(t(this,ot),t(this,U),Math.round(t(this,G)-t(this,S))+t(this,W)),t(this,J).length<60&&!t(this,qt)){console.log("getting historical klines...");const s=null,n=60-t(this,J).length,o=t(this,U).startTime-1;t(this,he).getHistKlines(s,o,n)}}drawDataPoint(e,s,n){const o=t(this,N)/(t(this,_t)-t(this,V)),a=Math.round(t(this,N)-(s.openPrice-t(this,V))*o),l=Math.round(t(this,N)-(s.highPrice-t(this,V))*o),u=Math.round(t(this,N)-(s.lowPrice-t(this,V))*o),d=Math.round(t(this,N)-(s.closePrice-t(this,V))*o);if(this.drawKlineAt(n,l-2),this.drawKlineAt(n,u+2),e){const m=[].concat(...e).reduce((C,E)=>{const _=Math.round(E.y/this.bucketSize)*this.bucketSize,q=`${_}-${E.m}`;return C[q]||(C[q]={...E,y:_,q:0}),C[q].q+=E.q,C},{}),B=Math.max(...Object.values(m).map(C=>C.q));this.maxQuantity=B>this.maxQuantity?B:this.maxQuantity,Object.values(m).forEach(C=>{const E=Math.round(t(this,N)-(C.y-t(this,V))*o),_=this.scaleQuantity(C.q);this.drawTradesAt(n,E,C.m,_)})}t(this,p).beginPath(),t(this,p).moveTo(n+t(this,S)/2,a),t(this,p).lineTo(n+t(this,S)/2,d),t(this,p).strokeStyle=d<a?"#9BE6D1":"#E6A1A0",t(this,p).stroke()}drawKlineAt(e,s){t(this,p).beginPath(),t(this,p).moveTo(e+5,s),t(this,p).lineTo(e+t(this,S)-5,s),t(this,p).strokeStyle="rgba(200, 200, 200, 0.5)",t(this,p).stroke()}drawTradesAt(e,s,n,o){t(this,p).beginPath(),n?(t(this,p).moveTo(e-4+t(this,S)/2,s),t(this,p).lineTo(e-4+t(this,S)/2-o,s),t(this,p).strokeStyle="rgba(192, 80, 77, 1)"):(t(this,p).moveTo(e+4+t(this,S)/2,s),t(this,p).lineTo(e+4+t(this,S)/2+o,s),t(this,p).strokeStyle="rgba(81, 205, 160, 1)"),t(this,p).stroke()}scaleQuantity(e){const o=t(this,S)/2-4;return 0+(e-.001)*(o-0)/(this.maxQuantity-.001)}}he=new WeakMap,p=new WeakMap,G=new WeakMap,N=new WeakMap,J=new WeakMap,St=new WeakMap,U=new WeakMap,ot=new WeakMap,de=new WeakMap,V=new WeakMap,_t=new WeakMap,It=new WeakMap,S=new WeakMap,Ot=new WeakMap,At=new WeakMap,at=new WeakMap,Bt=new WeakMap,W=new WeakMap,ut=new WeakMap,Mt=new WeakMap,xt=new WeakMap,qt=new WeakMap;var me,v,Tt,F,Nt,ht,X,dt,Vt,Ft,Xt,Dt;class qe{constructor(e,s,n,o,a){r(this,me,void 0);r(this,v,void 0);r(this,Tt,void 0);r(this,F,void 0);r(this,Nt,void 0);r(this,ht,void 0);r(this,X,void 0);r(this,dt,void 0);r(this,Vt,.997);r(this,Ft,1.003);K(this,"bucketSize");r(this,Xt,!0);r(this,Dt,0);i(this,me,e),i(this,v,s),this.canvas=n,i(this,Tt,o),i(this,F,a),this.maxQuantity=20}panY(e){i(this,Xt,!1);const s=t(this,F)/(t(this,dt)-t(this,X)),n=e/s;i(this,Dt,t(this,Dt)+n)}zoomY(e){const l=.001+.009000000000000001*e,u=.001+(.01-.001)*e;i(this,Vt,Math.round((1-l)*1e4)/1e4),i(this,Ft,Math.round((1+u)*1e4)/1e4)}resetZoomAndPan(){i(this,Xt,!0),i(this,Vt,.997),i(this,Ft,1.003),i(this,Dt,0)}resetData(){i(this,Nt,null),i(this,ht,null),i(this,X,null),i(this,dt,null),i(this,Xt,!0)}updateData(e,s){const{k:{o:n,h:o,l:a,c:l}}=e;i(this,Nt,{openPrice:n,highPrice:o,lowPrice:a,closePrice:l});const{asks:u,bids:d}=s;i(this,ht,{asks:u,bids:d}),i(this,X,Math.min((Number(o)+Number(a))/2*t(this,Vt),a)+t(this,Dt)),i(this,dt,Math.max((Number(o)+Number(a))/2*t(this,Ft),o)+t(this,Dt)),this.drawStart()}drawStart(){t(this,v).clearRect(0,0,t(this,Tt),t(this,F));const e=t(this,F)/(t(this,dt)-t(this,X)),{closePrice:s,openPrice:n}=t(this,Nt),o=Math.round(t(this,F)-(s-t(this,X))*e),a=Math.round(t(this,F)-(n-t(this,X))*e),l=o>a?"#C0504E":o<a?"#51CDA0":"#c8c8c8";if(this.drawTextAt(o,Number(s),l),this.drawTextAt(t(this,F)-10,Number((Math.round(t(this,X)/this.bucketSize)*this.bucketSize).toFixed(4)),"#c8c8c8"),this.drawTextAt(15,Number((Math.round(t(this,dt)/this.bucketSize)*this.bucketSize).toFixed(4)),"#c8c8c8"),this.maxQuantity=20,t(this,ht).asks&&t(this,ht).bids){const c=E=>E.reduce((_,q)=>{const Jt=Math.round(q[0]/this.bucketSize)*this.bucketSize;return _[Jt]||(_[Jt]=0),_[Jt]+=parseFloat(q[1]),_},{}),m=c(t(this,ht).asks),B=c(t(this,ht).bids),C=[...Object.values(m),...Object.values(B)];this.maxQuantity=Math.max.apply(null,C),Object.entries(m).forEach(([E,_])=>{const q=Math.round(t(this,F)-(E-t(this,X))*e);this.drawLineAt(q,"#C0504E",_)}),Object.entries(B).forEach(([E,_])=>{const q=Math.round(t(this,F)-(E-t(this,X))*e);this.drawLineAt(q,"#51CDA0",_)})}t(this,v).font="10px monospace",t(this,v).fillStyle="#c8c8c8";let u=Math.round(this.maxQuantity),d=t(this,v).measureText(u).width;t(this,v).fillText(u,t(this,Tt)-5-d,20)}drawLineAt(e,s,n){const o=n/this.maxQuantity*(t(this,Tt)-60);t(this,v).beginPath(),t(this,v).moveTo(60,e),t(this,v).lineTo(o+60,e),t(this,v).strokeStyle=s,t(this,v).lineWidth=1,t(this,v).stroke()}drawTextAt(e,s,n){t(this,v).font="11px monospace",t(this,v).fillStyle=n,t(this,v).fillText(s,5,e)}}me=new WeakMap,v=new WeakMap,Tt=new WeakMap,F=new WeakMap,Nt=new WeakMap,ht=new WeakMap,X=new WeakMap,dt=new WeakMap,Vt=new WeakMap,Ft=new WeakMap,Xt=new WeakMap,Dt=new WeakMap;var fe,b,tt,P,rt,lt,Zt,Yt,Ht,I,et,$,re;class Ne{constructor(e,s,n,o,a){r(this,fe,void 0);r(this,b,void 0);r(this,tt,void 0);r(this,P,void 0);r(this,rt,[]);r(this,lt,void 0);r(this,Zt,void 0);r(this,Yt,void 0);r(this,Ht,60);r(this,I,void 0);r(this,et,30);r(this,$,0);r(this,re,!1);i(this,fe,e),i(this,b,s),this.canvas=n,i(this,tt,o),i(this,P,a),i(this,I,Math.round(1*60*1e3/(t(this,et)*60*1e3)*(t(this,tt)-t(this,Ht))))}panX(e){i(this,$,t(this,$)+e<0?0:t(this,$)+e)}zoomX(e){i(this,et,30+-20*e),i(this,I,Math.round(1*60*1e3/(t(this,et)*60*1e3)*(t(this,tt)-t(this,Ht))))}resetZoomAndPan(){i(this,$,0),i(this,et,30),i(this,I,Math.round(1*60*1e3/(t(this,et)*60*1e3)*(t(this,tt)-t(this,Ht))))}resetData(){i(this,rt,[]),i(this,lt,null),i(this,Zt,null),i(this,Yt,null),i(this,$,0),i(this,re,!1)}resolveHistData(e,s){e==="klines"&&(i(this,re,!0),s.forEach(n=>{const[o,,,,,a,l,,,u,,,]=n,d={startTime:o,endTime:l,totalVolume:a,buyVolume:u,sellVolume:a-u};t(this,rt).unshift(d)}))}updateData(e){const{k:{t:s,T:n,v:o,V:a}}=e,l=o-a;i(this,Yt,Math.round(t(this,rt).reduce((u,d)=>Math.max(u,d.buyVolume,d.sellVolume),Math.max(a,l)))),t(this,Zt)!==s&&(t(this,lt)&&t(this,rt).push(t(this,lt)),i(this,Zt,s)),i(this,lt,{startTime:s,endTime:n,buyVolume:a,sellVolume:l}),this.drawStart()}drawStart(){if(t(this,b).clearRect(0,0,t(this,tt),t(this,P)),t(this,rt).length>0){const e=t(this,lt).startTime-t(this,et)*60*1e3+t(this,$);t(this,rt).forEach((s,n)=>{const o=Math.round((s.startTime-e)/(t(this,et)*60*1e3)*(t(this,tt)-t(this,I)));this.drawDataPoint(s,o+t(this,$))})}this.drawDataPoint(t(this,lt),Math.round(t(this,tt)-t(this,I))+t(this,$))}drawDataPoint(e,s){const n=(t(this,P)-20)/t(this,Yt),o=Math.max(0,Math.min(t(this,P)-20,Math.round(t(this,P)-20-e.buyVolume*n))),a=Math.max(0,Math.min(t(this,P)-20,Math.round(t(this,P)-20-e.sellVolume*n)));t(this,b).beginPath(),t(this,b).moveTo(s,0),t(this,b).lineTo(s,t(this,P)-20),t(this,b).strokeStyle="rgba(200, 200, 200, 0.4)",t(this,b).lineWidth=1,t(this,b).stroke(),this.drawTimeLabel(s,e.startTime),this.drawKlineAt(s+t(this,I)/2+t(this,I)/8,o,"#51CDA0"),this.drawKlineAt(s+t(this,I)/2-t(this,I)/8,a,"#C0504E")}drawKlineAt(e,s,n){t(this,b).beginPath(),t(this,b).moveTo(e,t(this,P)-20),t(this,b).lineTo(e,s),t(this,b).strokeStyle=n,t(this,b).lineWidth=t(this,I)/6,t(this,b).stroke()}drawTimeLabel(e,s){const n=new Date(s),o=n.getHours().toString().padStart(2,"0")+":"+n.getMinutes().toString().padStart(2,"0");t(this,b).font="11px monospace",t(this,b).fillStyle="#c8c8c8",t(this,b).fillText(o,e,t(this,P))}}fe=new WeakMap,b=new WeakMap,tt=new WeakMap,P=new WeakMap,rt=new WeakMap,lt=new WeakMap,Zt=new WeakMap,Yt=new WeakMap,Ht=new WeakMap,I=new WeakMap,et=new WeakMap,$=new WeakMap,re=new WeakMap;var pe,L,st,Z,z,Q,Se,j,Ut,Wt,Lt,$t,it,Qt,Y,nt,O,jt,Kt,Ct,le,mt;class Ve{constructor(e,s,n,o,a){r(this,pe,void 0);r(this,L,void 0);r(this,st,void 0);r(this,Z,void 0);r(this,z,[]);r(this,Q,void 0);r(this,Se,void 0);r(this,j,[]);r(this,Ut,void 0);r(this,Wt,void 0);r(this,Lt,void 0);r(this,$t,void 0);r(this,it,void 0);r(this,Qt,60);r(this,Y,void 0);r(this,nt,30);r(this,O,0);r(this,jt,0);r(this,Kt,!0);r(this,Ct,!0);r(this,le,void 0);r(this,mt,void 0);i(this,pe,e),i(this,L,s),this.canvas=n,i(this,st,o),i(this,Z,a),i(this,Y,Math.round(1*60*1e3/(t(this,nt)*60*1e3)*(t(this,st)-t(this,Qt))))}panX(e){i(this,O,t(this,O)+e<0?0:t(this,O)+e)}zoomX(e){i(this,nt,30+-20*e),i(this,Y,Math.round(1*60*1e3/(t(this,nt)*60*1e3)*(t(this,st)-t(this,Qt))))}resetZoomAndPan(){i(this,O,0),i(this,nt,30),i(this,Y,Math.round(1*60*1e3/(t(this,nt)*60*1e3)*(t(this,st)-t(this,Qt))))}resetData(){i(this,z,[]),i(this,j,[]),i(this,Q,null),i(this,Ut,null),i(this,Wt,null),i(this,Lt,null),i(this,$t,null),i(this,it,null),i(this,jt,0),i(this,O,0)}toggleIndicator(e,s){e==="oi"?i(this,Kt,s):e==="cvd"&&i(this,Ct,s)}async updateData(e,s){const{k:{t:n,T:o}}=e;if(i(this,jt,t(this,jt)+s.reduce((a,l)=>l.m?a-l.q:a+l.q,0)),t(this,Ut)!==n&&(t(this,Q)&&(this.fetchOI(ve).then(a=>{t(this,j).push(a)}),t(this,z).push(t(this,Q)),t(this,z).length>60&&(t(this,z).shift(),t(this,j).shift())),i(this,Ut,n)),i(this,Q,{startTime:n,endTime:o,cumVolumeDelta:t(this,jt)}),t(this,Kt)||t(this,Ct)){i(this,Wt,t(this,j).length>0?Math.max(...t(this,j).map(Number))*1.001:0),i(this,Lt,t(this,j).length>0?Math.min(...t(this,j).map(Number))*.999:0);const a=t(this,z).map(l=>l.cumVolumeDelta);i(this,$t,(Math.max(...a,t(this,Q).cumVolumeDelta)||0)*1.001),i(this,it,(Math.min(...a,t(this,Q).cumVolumeDelta)||0)*.999),i(this,le,t(this,Z)/(t(this,Wt)-t(this,Lt))),i(this,mt,t(this,Z)/(t(this,$t)-t(this,it))),this.drawStart()}}drawStart(){if(t(this,L).clearRect(0,0,t(this,st),t(this,Z)),t(this,z).length>0){const e=t(this,Q).startTime-t(this,nt)*60*1e3+t(this,O);t(this,z).forEach((s,n)=>{const o=Math.round((s.startTime-e)/(t(this,nt)*60*1e3)*(t(this,st)-t(this,Y)));if(t(this,Kt)){const a=t(this,Z)-(t(this,j)[n]-t(this,Lt))*t(this,le);this.drawOIPoint(o+t(this,O),a)}if(t(this,Ct)){const a=t(this,Z)-(s.cumVolumeDelta-t(this,it))*t(this,mt);if(n>0){const l=t(this,Z)-(t(this,z)[n-1].cumVolumeDelta-t(this,it))*t(this,mt);this.drawCVDLine(o+t(this,O),l,o+t(this,Y)+t(this,O),a)}}})}if(t(this,Ct)){const e=t(this,Z)-(t(this,Q).cumVolumeDelta-t(this,it))*t(this,mt),s=Math.round(t(this,st)-t(this,Y))+t(this,O);if(t(this,z).length>0){const n=t(this,Z)-(t(this,z)[t(this,z).length-1].cumVolumeDelta-t(this,it))*t(this,mt);this.drawCVDLine(s,n,s+t(this,Y),e)}else this.drawCVDLine(s,0,s+t(this,Y),e)}}drawCVDLine(e,s,n,o){t(this,L).beginPath(),t(this,L).moveTo(e,s),t(this,L).lineTo(n,o),t(this,L).lineWidth=2,t(this,L).strokeStyle="rgba(238, 216, 139, 0.3)",t(this,L).stroke()}drawOIPoint(e,s){t(this,L).beginPath(),t(this,L).arc(e+t(this,Y),s,2,0,2*Math.PI),t(this,L).fillStyle="#c8c8c8",t(this,L).fill()}async fetchOI(e){return(await(await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${e}`)).json()).openInterest}}pe=new WeakMap,L=new WeakMap,st=new WeakMap,Z=new WeakMap,z=new WeakMap,Q=new WeakMap,Se=new WeakMap,j=new WeakMap,Ut=new WeakMap,Wt=new WeakMap,Lt=new WeakMap,$t=new WeakMap,it=new WeakMap,Qt=new WeakMap,Y=new WeakMap,nt=new WeakMap,O=new WeakMap,jt=new WeakMap,Kt=new WeakMap,Ct=new WeakMap,le=new WeakMap,mt=new WeakMap;async function Ce(){let e=Date.now()-25*60*60*1e3,s=e+60*60*1e3,n={};const[o,a]=await Promise.all([Ze(),Ye()]),l=Object.keys(o).filter(c=>!["BTCSTUSDT","CVCUSDT","DOGEUSDC","COCOSUSDT","BNBBTC","ETHBTC","RAYUSDT","HNTUSDT","SCUSDT","WIFUSDT","BTSUSDT","TOMOUSDT","FTTUSDT","SRMUSDT"].includes(c)&&!c.includes("_")),u=l.map(c=>Fe(c,e,s)),d=await Promise.all(u);return l.forEach((c,m)=>{a.hasOwnProperty(c)&&(n[c]={...o[c],...a[c],...d[m]})}),n}async function Fe(h,e,s){let n;try{n=await Xe(h);const a=await(await fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${h}&period=30m&limit=1&startTime=${e}&endTime=${s}`)).json(),l=Math.round(a[0].sumOpenInterest),u=Math.round((n-l)/l*1e4)/100;return{open_interest:n,OI_24hrChange:u}}catch{return{open_interest:n,OI_24hrChange:NaN}}}async function Xe(h){try{const s=await(await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${h}`)).json();return Number(s.openInterest)}catch(e){return console.log(e,h),NaN}}async function Ze(){let h={};const s=await(await fetch("https://fapi.binance.com/fapi/v1/premiumIndex")).json();for(let n of s){let o=n.symbol,a=parseFloat(n.lastFundingRate)*100,l=parseFloat(n.markPrice);h[o]={funding_rate:parseFloat(a.toFixed(3)),mark_price:Math.round(l*1e4)/1e4}}return h}async function Ye(){let h={};const s=await(await fetch("https://fapi.binance.com/fapi/v1/ticker/24hr")).json();for(let n of s){let o=n.symbol,a=n.quoteVolume,l=n.priceChangePercent;h[o]={change:Number(l),volume:Math.round(a)}}return h}var ft,pt,Rt,A,Gt;class He{constructor(){r(this,ft,void 0);r(this,pt,[]);r(this,Rt,[]);r(this,A,void 0);r(this,Gt,!0);K(this,"last_update_id");K(this,"order_book");console.log("Initializing WebSocketService")}createWebSocket(e,s){t(this,ft)&&t(this,ft).readyState===1&&(console.log("Closing existing websocket connection for symbol:",t(this,A).toUpperCase()),this.order_book.shouldRefresh=!1,t(this,ft).close(),i(this,Gt,!0),this.order_book=null,i(this,pt,[]),i(this,Rt,[])),console.log("Creating websocket connection for symbol:",e),i(this,A,e.toLowerCase()),ke(t(this,A)).then(n=>{i(this,ft,new WebSocket(`wss://fstream.binance.com/stream?streams=${t(this,A)}@aggTrade/${t(this,A)}@depth@100ms/${t(this,A)}@kline_1m`)),this.setupEventListeners(t(this,ft),s),this.last_update_id=n.lastUpdateId,this.order_book=new Ue(t(this,A),n.bids,n.asks)}).catch(n=>{console.error("Error initializing the order book:",n)})}setupEventListeners(e,s){e.addEventListener("open",()=>{this.order_book.refresh_order_book(t(this,A)),console.log("New WebSocket connection opened")}),e.addEventListener("close",()=>{console.log("Previous WebSocket connection was closed")});let n=!1;e.addEventListener("message",async o=>{let a=JSON.parse(o.data);if(a.stream.endsWith("@aggTrade")){let l=a.data;t(this,pt).push({x:l.T,y:parseFloat(l.p),q:parseFloat(l.q),m:l.m})}else if(a.stream.endsWith("@depth@100ms")){if(n){console.log("isHandlingDepth:",n);return}n=!0,await this.handleDepth(a.data),n=!1,s({kline:t(this,Rt),depth:this.order_book.order_book,tradesBuffer:t(this,pt)}),i(this,pt,[])}else a.stream.endsWith("@kline_1m")&&i(this,Rt,a.data)})}async handleDepth(e){let s=e.u,n=e.U,o=e.pu;if(s<this.last_update_id){console.log("finalUpdateId < last_update_id",s,this.last_update_id);return}if(t(this,Gt))if(n<=this.last_update_id&&this.last_update_id<=s)console.log("First processed event succeeded"),i(this,Gt,!1);else{await this.reinitializeOrderBook(t(this,A));return}else if(o!=this.last_update_id){await this.reinitializeOrderBook(t(this,A));return}await this.order_book.update_order_book(e.b,e.a),this.last_update_id=s}async reinitializeOrderBook(e){console.log("Out of sync, reinitializing order book...");const s=await ke(e);this.last_update_id=s.lastUpdateId,this.order_book.order_book=this.order_book.initialize_order_book(s.bids,s.asks),i(this,pt,[])}}ft=new WeakMap,pt=new WeakMap,Rt=new WeakMap,A=new WeakMap,Gt=new WeakMap;class Ue{constructor(e,s,n){K(this,"currentSymbol");K(this,"order_book");K(this,"shouldRefresh",!0);console.log("initializing new OrderBook class"),this.currentSymbol=e,this.order_book=this.initialize_order_book(s,n)}initialize_order_book(e,s){let n=e.map(a=>a.map(Number)),o=s.map(a=>a.map(Number));return{bids:n,asks:o}}async refresh_order_book(e){let s=new AbortController,n=setInterval(async()=>{if(!this.shouldRefresh||e!==this.currentSymbol)clearInterval(n),s.abort();else{s=new AbortController;try{let o=await ke(e,{signal:s.signal});this.order_book=this.initialize_order_book(o.bids,o.asks)}catch(o){o.name==="AbortError"?console.log("Fetch operation aborted"):console.error("Error fetching order book:",o)}}},6e3)}async update_order_book(e,s){let n=e.map(a=>a.map(Number)),o=s.map(a=>a.map(Number));[this.order_book.bids,this.order_book.asks]=await this.prepare_order_book(this.order_book.bids,this.order_book.asks,n,o)}async prepare_order_book(e,s,n,o){try{const a=new Map([...e,...n].filter(c=>c[0]>=e[e.length-1][0])),l=new Map([...s,...o].filter(c=>c[0]<=s[s.length-1][0]));let u=Array.from(a.entries()).filter(c=>c[1]!==0).sort((c,m)=>m[0]-c[0]),d=Array.from(l.entries()).filter(c=>c[1]!==0).sort((c,m)=>c[0]-m[0]);return u[0][0]>=d[0][0]&&(u=u.filter(c=>c[0]<n[n.length-1][0]),d=d.filter(c=>c[0]>o[0][0]),console.log("Error: bids[0] >= asks[0], rehandled to: ",u[0][0],d[0][0])),[u,d]}catch(a){return console.error("Error preparing order book:",a),[n,o]}}}async function ke(h){return await(await fetch(`https://fapi.binance.com/fapi/v1/depth?symbol=${h}&limit=500`)).json()}const ge=["btn1","btn2","btn3","btn4"],We=["tickers-menu","menu2","menu3","settings-menu"],$e=[ze,Te,Te,Ke];for(let h=0;h<ge.length;h++){const e=document.getElementById(ge[h]);e.addEventListener("click",$e[h]),e.addEventListener("click",function(){oe(ge[h],We[h])})}const Et=document.getElementById("tickers-menu"),zt=document.getElementById("settings-menu");let _e=document.getElementById("ticker-search"),ue;_e.addEventListener("keyup",function(){ue=this.value.toLowerCase();let h=document.querySelectorAll("#ticker-table tbody tr");for(let e of h)e.cells[0].textContent.toLowerCase().includes(ue)?e.style.display="":e.style.display="none"});function Qe(h){ss(h),console.log("canvas was started with symbol: "+h),_e.value="",ue="";let e=document.querySelectorAll("#ticker-table tbody tr");for(let s of e)s.style.display="";ze()}function je(){const h=new Date,e=h.getHours().toString().padStart(2,"0"),s=h.getMinutes().toString().padStart(2,"0"),n=h.getSeconds().toString().padStart(2,"0");return e+":"+s+":"+n}function Ee(){const h=document.getElementById("tickers-update-info");h.textContent="Last updated at "+je()}const ct=document.getElementById("tickers-update-btn");ct.addEventListener("click",function(){ct.className="loading-animation",ct.disabled=!0,Ce().then(h=>{ct.className="",Pe(h),Ee(),ct.disabled=!1})});window.onload=function(){ct.className="loading-animation",ct.disabled=!0,Ce().then(h=>{ct.className="",Pe(h),Ee(),ct.disabled=!1})};function Te(){console.log("show menu")}function ze(){_e.value="",ue="";let h=document.querySelectorAll("#ticker-table tbody tr");for(let e of h)e.style.display="";Et.style.display=Et.style.display==="none"?"block":"none",oe("btn1","tickers-menu"),Et.style.display==="block"?document.addEventListener("click",ne):document.removeEventListener("click",ne)}function Ke(){zt.style.display=zt.style.display==="none"?"block":"none",oe("btn4","settings-menu"),zt.style.display==="block"?document.addEventListener("click",ne):document.removeEventListener("click",ne)}function ne(h){const e=document.querySelector("#btn1"),s=document.querySelector("#btn4");!zt.contains(h.target)&&!s.contains(h.target)&&(zt.style.display="none",oe("btn4","settings-menu")),!Et.contains(h.target)&&!e.contains(h.target)&&(Et.style.display="none",oe("btn1","tickers-menu")),zt.style.display==="none"&&Et.style.display==="none"&&document.removeEventListener("click",ne)}function oe(h,e){const s=document.getElementById(e),n=document.getElementById(h);(h==="btn1"||h==="btn4")&&(s.style.display==="block"?n.classList.add("active"):n.classList.remove("active"))}function De(h){return h>=1e9?(h/1e9).toFixed(2)+"b":h>=1e6?(h/1e6).toFixed(2)+"m":h>=1e3?(h/1e3).toFixed(2)+"k":h}function be(h,e,s){let n;return e==="mark_price"?h>10?n=Math.round(h*100)/100:n=Math.round(h*1e4)/1e4:e==="volume"?(n=De(h),n="$"+n):e==="open_interest"&&(n=De(h*s),n="$"+n),n}function Pe(h){let e=document.querySelector("#tickers-menu table tbody");e.innerHTML="";let s=Object.entries(h);s.sort(([,n],[,o])=>o.volume-n.volume);for(let n=0;n<s.length;n++){let[o,a]=s[n],l;n<e.rows.length?l=e.rows[n]:(l=e.insertRow(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell()),l.classList.add("table-row"),l.cells[0].textContent=o,l.cells[1].textContent=be(a.mark_price,"mark_price",a.mark_price),l.cells[2].textContent=(Math.round(a.change*100)/100).toFixed(2)+"%",l.cells[3].textContent=a.funding_rate+"%",l.cells[4].textContent=be(a.open_interest,"open_interest",a.mark_price),l.cells[5].textContent=a.OI_24hrChange+"%",l.cells[6].textContent=be(a.volume,"volume",a.mark_price);const u=Math.min(Math.abs(a.change/100),1),d=Math.max(Math.abs(a.funding_rate*50),.2);a.change<0?l.style.backgroundColor="rgba(192, 80, 78, "+u*1.5+")":l.style.backgroundColor="rgba(81, 205, 160, "+u+")",a.funding_rate>0?l.cells[3].style.color="rgba(212, 80, 78, "+d*1.5+")":l.cells[3].style.color="rgba(81, 246, 160, "+d*1.5+")",l.addEventListener("click",function(){Qe(o)})}}function ye(h){const e=h.clientWidth,s=h.clientHeight;(h.width!==e||h.height!==s)&&(h.width=e,h.height=s)}let te=document.querySelector("#canvas1");ye(te);let Re=te.getContext("2d"),ee=document.querySelector("#canvas2");ye(ee);let Ge=ee.getContext("2d"),se=document.querySelector("#canvas3");ye(se);let Je=se.getContext("2d"),ie=document.querySelector("#canvas4");ye(ie);let ts=ie.getContext("2d");const es=new He,Le=new Ae(Re,te,te.width,te.height,Ge,ee,ee.width,ee.height,Je,se,se.width,se.height,ts,ie,ie.width,ie.height);function ss(h){is(h).then(e=>{es.createWebSocket(h,s=>Le.updateData(s)),Le.startNew(h,e),document.querySelector("#ticksize-select").dispatchEvent(new Event("change")),document.querySelector("#tickerInfo-name").textContent=h})}async function is(h){let n=(await(await fetch("https://fapi.binance.com/fapi/v1/exchangeInfo")).json()).symbols.find(o=>o.symbol===h);return n?n.filters[0].tickSize:null}
