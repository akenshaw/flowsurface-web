var Se=Object.defineProperty;var _e=(h,e,s)=>e in h?Se(h,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[e]=s;var U=(h,e,s)=>(_e(h,typeof e!="symbol"?e+"":e,s),s),ce=(h,e,s)=>{if(!e.has(h))throw TypeError("Cannot "+s)};var t=(h,e,s)=>(ce(h,e,"read from private field"),s?s.call(h):e.get(h)),r=(h,e,s)=>{if(e.has(h))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(h):e.set(h,s)},i=(h,e,s,n)=>(ce(h,e,"write to private field"),n?n.call(h,s):e.set(h,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();let fe;var p,_,x,D,Ht,w,ut,Mt,mt,X,pt,M;class Me{constructor(e,s,n,o,a,l,c,u,d,z,q,f,S,H,qt,ke){U(this,"zoomYLevel",.2222);U(this,"zoomXLevel",0);r(this,p,void 0);r(this,_,void 0);r(this,x,void 0);r(this,D,void 0);r(this,Ht,void 0);r(this,w,void 0);r(this,ut,void 0);r(this,Mt,!1);r(this,mt,void 0);r(this,X,!0);r(this,pt,void 0);r(this,M,!1);i(this,p,new xe(this,e,s,n,o)),i(this,_,new Te(this,d,z,q,f)),i(this,x,new Ce(this,S,H,qt,ke)),i(this,D,new De(this,a,l,c,u)),i(this,pt,document.querySelector("#btn2")),t(this,pt).addEventListener("click",y=>{i(this,X,!t(this,X)),this.updateScaleBtn()});const le=document.querySelector("#ticksize-select");le.addEventListener("change",y=>{const g=t(this,Ht)*le.value;console.log("new tick size:",g),t(this,p).bucketSize=g,t(this,p).maxQuantity=20,t(this,_).bucketSize=g}),t(this,p).canvas.addEventListener("mousedown",y=>{i(this,Mt,!0),i(this,mt,{x:y.clientX,y:y.clientY})}),t(this,p).canvas.addEventListener("mousemove",y=>{if(t(this,Mt)){i(this,X,!1);let g={x:y.clientX,y:y.clientY},tt=g.x-t(this,mt).x,Rt=g.y-t(this,mt).y;t(this,M)||(i(this,M,!0),requestAnimationFrame(()=>{t(this,p).panXY(tt,Rt),t(this,_).panY(Rt),t(this,x).panX(tt),t(this,D).panX(tt),t(this,p).updateData(t(this,w),[]),t(this,_).updateData(t(this,w),t(this,ut)),t(this,x).updateData(t(this,w)),t(this,D).updateData(t(this,w)),i(this,M,!1)})),i(this,mt,g),this.updateScaleBtn()}}),["mouseup","mouseleave"].forEach(y=>t(this,p).canvas.addEventListener(y,()=>i(this,Mt,!1))),t(this,p).canvas.addEventListener("wheel",y=>{y.preventDefault(),i(this,X,!1);const g=5e-4/(.01-.001);let tt=this.zoomYLevel-(y.deltaY>0?-g:g),Rt=this.zoomXLevel+(y.deltaY>0?-g:g);this.zoomYLevel=Math.max(0,Math.min(tt,1)),this.zoomXLevel=Math.max(0,Math.min(Rt,1)),t(this,M)||(i(this,M,!0),requestAnimationFrame(()=>{t(this,p).zoomY(this.zoomYLevel),t(this,p).zoomX(this.zoomXLevel),t(this,_).zoomY(this.zoomYLevel),t(this,x).zoomX(this.zoomXLevel),t(this,D).zoomX(this.zoomXLevel),t(this,p).updateData(t(this,w),[]),t(this,_).updateData(t(this,w),t(this,ut)),t(this,x).updateData(t(this,w)),t(this,D).updateData(t(this,w)),i(this,M,!1)}),this.updateScaleBtn())}),t(this,_).canvas.addEventListener("wheel",y=>{y.preventDefault(),i(this,X,!1);const g=5e-4/(.01-.001);let tt=this.zoomYLevel-(y.deltaY>0?-g:g);this.zoomYLevel=Math.max(0,Math.min(tt,1)),t(this,M)||(i(this,M,!0),requestAnimationFrame(()=>{t(this,p).zoomY(this.zoomYLevel),t(this,_).zoomY(this.zoomYLevel),t(this,p).updateData(t(this,w),[]),t(this,_).updateData(t(this,w),t(this,ut)),i(this,M,!1)}),this.updateScaleBtn())}),t(this,x).canvas.addEventListener("wheel",y=>{y.preventDefault(),i(this,X,!1);const g=5e-4/(.01-.001);let tt=this.zoomXLevel+(y.deltaY>0?-g:g);this.zoomXLevel=Math.max(0,Math.min(tt,1)),t(this,M)||(i(this,M,!0),requestAnimationFrame(()=>{t(this,p).zoomX(this.zoomXLevel),t(this,x).zoomX(this.zoomXLevel),t(this,D).zoomX(this.zoomXLevel),t(this,p).updateData(t(this,w),[]),t(this,x).updateData(t(this,w)),t(this,D).updateData(t(this,w)),i(this,M,!1)})),this.updateScaleBtn()})}updateScaleBtn(){t(this,X)?(t(this,p).resetZoomAndPan(),t(this,_).resetZoomAndPan(),t(this,x).resetZoomAndPan(),t(this,D).resetZoomAndPan(),t(this,pt).innerHTML='<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 448 512"><path fill="#c8c8c8" d="M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"/></svg>'):t(this,pt).innerHTML='<svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512"><path fill="#c8c8c8" d="M352 144c0-44.2 35.8-80 80-80s80 35.8 80 80v48c0 17.7 14.3 32 32 32s32-14.3 32-32V144C576 64.5 511.5 0 432 0S288 64.5 288 144v48H64c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V256c0-35.3-28.7-64-64-64H352V144z"/></svg>'}updateData(e){i(this,w,e.kline),i(this,ut,e.depth),t(this,p).updateData(e.kline,e.tradesBuffer),t(this,_).updateData(e.kline,e.depth),t(this,x).updateData(e.kline),t(this,D).updateData(e.kline)}startNew(e,s){i(this,X,!0),this.updateScaleBtn(),t(this,p).resetData(),t(this,_).resetData(),t(this,x).resetData(),t(this,D).resetData(),this.zoomYLevel=.2222,this.zoomXLevel=0,fe=e,i(this,Ht,s)}}p=new WeakMap,_=new WeakMap,x=new WeakMap,D=new WeakMap,Ht=new WeakMap,w=new WeakMap,ut=new WeakMap,Mt=new WeakMap,mt=new WeakMap,X=new WeakMap,pt=new WeakMap,M=new WeakMap;var Kt,m,W,E,et,ft,st,ht,xt,I,bt,Dt,k,Tt,Ct,it,Lt,Z,rt;class xe{constructor(e,s,n,o,a){r(this,Kt,void 0);r(this,m,void 0);r(this,W,void 0);r(this,E,void 0);r(this,et,[]);r(this,ft,[]);r(this,st,void 0);r(this,ht,[]);r(this,xt,void 0);r(this,I,void 0);r(this,bt,void 0);r(this,Dt,60);r(this,k,void 0);r(this,Tt,.997);r(this,Ct,1.003);r(this,it,30);U(this,"bucketSize");r(this,Lt,!0);r(this,Z,0);r(this,rt,0);i(this,Kt,e),i(this,m,s),this.canvas=n,i(this,W,o),i(this,E,a),i(this,k,Math.round(1*60*1e3/(30*60*1e3)*(t(this,W)-t(this,Dt)))),this.tradesDrawType=0,this.maxQuantity=20}panXY(e,s){i(this,Lt,!1);const n=t(this,E)/(t(this,bt)-t(this,I)),o=s/n;i(this,rt,t(this,rt)+o),i(this,Z,t(this,Z)+e<0?0:t(this,Z)+e)}zoomY(e){const l=.001+.009000000000000001*e,c=.001+(.01-.001)*e;i(this,Tt,Math.round((1-l)*1e4)/1e4),i(this,Ct,Math.round((1+c)*1e4)/1e4)}zoomX(e){i(this,it,30+-20*e),i(this,k,Math.round(1*60*1e3/(t(this,it)*60*1e3)*(t(this,W)-t(this,Dt))))}resetZoomAndPan(){i(this,Lt,!0),i(this,Z,0),i(this,rt,0),i(this,Tt,.997),i(this,Ct,1.003),i(this,it,30),i(this,k,Math.round(1*60*1e3/(t(this,it)*60*1e3)*(t(this,W)-t(this,Dt))))}resetData(){i(this,et,[]),i(this,ft,[]),i(this,st,null),i(this,ht,[]),i(this,xt,null),i(this,I,null),i(this,bt,null),i(this,Lt,!0),i(this,Z,0),i(this,rt,0)}updateData(e,s){const{k:{t:n,T:o,o:a,h:l,l:c,c:u}}=e;i(this,I,Math.min((Number(l)+Number(c))/2*t(this,Tt),c)+t(this,rt)),i(this,bt,Math.max((Number(l)+Number(c))/2*t(this,Ct),l)+t(this,rt)),t(this,xt)!==a&&(t(this,st)&&(t(this,et).push(t(this,st)),t(this,ft).push(t(this,ht)),t(this,et).length>60&&(t(this,et).shift(),t(this,ft).shift()),i(this,ht,[])),i(this,xt,a)),i(this,st,{startTime:n,endTime:o,openPrice:a,highPrice:l,lowPrice:c,closePrice:u}),t(this,ht).push(s),this.drawStart()}drawStart(){if(t(this,m).clearRect(0,0,t(this,W),t(this,E)),t(this,et).length>0){const e=t(this,st).startTime-t(this,it)*60*1e3+t(this,Z);t(this,et).forEach((s,n)=>{const o=t(this,ft)[n],a=Math.round((s.startTime-e)/(t(this,it)*60*1e3)*(t(this,W)-t(this,k)));this.drawDataPoint(o,s,a+t(this,Z))})}this.drawDataPoint(t(this,ht),t(this,st),Math.round(t(this,W)-t(this,k))+t(this,Z))}drawDataPoint(e,s,n){const o=t(this,E)/(t(this,bt)-t(this,I)),a=Math.round(t(this,E)-(s.openPrice-t(this,I))*o),l=Math.round(t(this,E)-(s.highPrice-t(this,I))*o),c=Math.round(t(this,E)-(s.lowPrice-t(this,I))*o),u=Math.round(t(this,E)-(s.closePrice-t(this,I))*o);this.drawKlineAt(n,l-2),this.drawKlineAt(n,c+2);const z=[].concat(...e).reduce((f,S)=>{const H=Math.round(S.y/this.bucketSize)*this.bucketSize,qt=`${H}-${S.m}`;return f[qt]||(f[qt]={...S,y:H,q:0}),f[qt].q+=S.q,f},{}),q=Math.max(...Object.values(z).map(f=>f.q));this.maxQuantity=q>this.maxQuantity?q:this.maxQuantity,Object.values(z).forEach(f=>{const S=Math.round(t(this,E)-(f.y-t(this,I))*o),H=this.scaleQuantity(f.q);this.drawTradesAt(n,S,f.m,H)}),t(this,m).beginPath(),t(this,m).moveTo(n+t(this,k)/2,a),t(this,m).lineTo(n+t(this,k)/2,u),t(this,m).strokeStyle=u<a?"#9BE6D1":"#E6A1A0",t(this,m).stroke()}drawKlineAt(e,s){t(this,m).beginPath(),t(this,m).moveTo(e+5,s),t(this,m).lineTo(e+t(this,k)-5,s),t(this,m).strokeStyle="rgba(200, 200, 200, 0.5)",t(this,m).stroke()}drawTradesAt(e,s,n,o){t(this,m).beginPath(),n?(t(this,m).moveTo(e-4+t(this,k)/2,s),t(this,m).lineTo(e-4+t(this,k)/2-o,s),t(this,m).strokeStyle="rgba(192, 80, 77, 1)"):(t(this,m).moveTo(e+4+t(this,k)/2,s),t(this,m).lineTo(e+4+t(this,k)/2+o,s),t(this,m).strokeStyle="rgba(81, 205, 160, 1)"),t(this,m).stroke()}scaleQuantity(e){const o=t(this,k)/2-4;return 0+(e-.001)*(o-0)/(this.maxQuantity-.001)}}Kt=new WeakMap,m=new WeakMap,W=new WeakMap,E=new WeakMap,et=new WeakMap,ft=new WeakMap,st=new WeakMap,ht=new WeakMap,xt=new WeakMap,I=new WeakMap,bt=new WeakMap,Dt=new WeakMap,k=new WeakMap,Tt=new WeakMap,Ct=new WeakMap,it=new WeakMap,Lt=new WeakMap,Z=new WeakMap,rt=new WeakMap;var Gt,T,Q,nt,j,N,ae,Y,Pt,zt,yt,Et,gt,It,R,$,O,Ot;class De{constructor(e,s,n,o,a){r(this,Gt,void 0);r(this,T,void 0);r(this,Q,void 0);r(this,nt,void 0);r(this,j,[]);r(this,N,void 0);r(this,ae,void 0);r(this,Y,[]);r(this,Pt,void 0);r(this,zt,void 0);r(this,yt,void 0);r(this,Et,void 0);r(this,gt,void 0);r(this,It,60);r(this,R,void 0);r(this,$,30);r(this,O,0);r(this,Ot,0);i(this,Gt,e),i(this,T,s),this.canvas=n,i(this,Q,o),i(this,nt,a),i(this,R,Math.round(1*60*1e3/(t(this,$)*60*1e3)*(t(this,Q)-t(this,It))))}panX(e){i(this,O,t(this,O)+e<0?0:t(this,O)+e)}zoomX(e){i(this,$,30+-20*e),i(this,R,Math.round(1*60*1e3/(t(this,$)*60*1e3)*(t(this,Q)-t(this,It))))}resetZoomAndPan(){i(this,O,0),i(this,$,30),i(this,R,Math.round(1*60*1e3/(t(this,$)*60*1e3)*(t(this,Q)-t(this,It))))}resetData(){i(this,j,[]),i(this,Y,[]),i(this,N,null),i(this,Pt,null),i(this,zt,null),i(this,yt,null),i(this,Et,null),i(this,gt,null),i(this,Ot,0),i(this,O,0)}async updateData(e){const{k:{t:s,T:n,v:o,V:a}}=e,l=a-(o-a);if(i(this,Ot,t(this,Ot)+l),t(this,Pt)!==s){if(t(this,N)){t(this,j).push(t(this,N));const u=await this.fetchOI(fe);t(this,Y).push(u),t(this,j).length>60&&(t(this,j).shift(),t(this,Y).shift())}i(this,Pt,s)}i(this,N,{startTime:s,endTime:n,volumeDelta:l,cumVolumeDelta:t(this,Ot)}),i(this,zt,t(this,Y).length>0?Math.max(...t(this,Y).map(Number))*1.001:0),i(this,yt,t(this,Y).length>0?Math.min(...t(this,Y).map(Number))*.999:0);const c=t(this,j).map(u=>u.cumVolumeDelta);i(this,Et,(Math.max(...c,t(this,N).cumVolumeDelta)||0)*1.001),i(this,gt,(Math.min(...c,t(this,N).cumVolumeDelta)||0)*.999),this.drawStart()}drawStart(){if(t(this,T).clearRect(0,0,t(this,Q),t(this,nt)),t(this,j).length>0){const e=t(this,N).startTime-t(this,$)*60*1e3+t(this,O);t(this,j).forEach((s,n)=>{const o=Math.round((s.startTime-e)/(t(this,$)*60*1e3)*(t(this,Q)-t(this,R)));this.drawDataPoint(t(this,Y)[n],o+t(this,O),"OI"),this.drawDataPoint(s.cumVolumeDelta,o+t(this,O),"CVD")})}this.drawDataPoint(t(this,N).cumVolumeDelta,Math.round(t(this,Q)-t(this,R))+t(this,O),"CVD")}drawDataPoint(e,s,n){const o=Number(e);if(n==="OI"){const a=t(this,nt)/(t(this,zt)-t(this,yt)),l=t(this,nt)-(o-t(this,yt))*a;this.drawOIPoint(s,l)}else if(n==="CVD"){const a=t(this,nt)/(t(this,Et)-t(this,gt)),l=t(this,nt)-(o-t(this,gt))*a;this.drawCVDPoint(s,l)}}drawCVDPoint(e,s){t(this,T).beginPath(),t(this,T).arc(e+t(this,R)/2,s,2,0,2*Math.PI),t(this,T).fillStyle="#EED88B",t(this,T).fill()}drawOIPoint(e,s){t(this,T).beginPath(),t(this,T).arc(e+t(this,R),s,2,0,2*Math.PI),t(this,T).fillStyle="#c8c8c8",t(this,T).fill()}async fetchOI(e){return(await(await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${e}`)).json()).openInterest}}Gt=new WeakMap,T=new WeakMap,Q=new WeakMap,nt=new WeakMap,j=new WeakMap,N=new WeakMap,ae=new WeakMap,Y=new WeakMap,Pt=new WeakMap,zt=new WeakMap,yt=new WeakMap,Et=new WeakMap,gt=new WeakMap,It=new WeakMap,R=new WeakMap,$=new WeakMap,O=new WeakMap,Ot=new WeakMap;var Jt,v,wt,B,Bt,ot,A,lt,At,Vt,Xt,vt;class Te{constructor(e,s,n,o,a){r(this,Jt,void 0);r(this,v,void 0);r(this,wt,void 0);r(this,B,void 0);r(this,Bt,void 0);r(this,ot,void 0);r(this,A,void 0);r(this,lt,void 0);r(this,At,.997);r(this,Vt,1.003);U(this,"bucketSize");r(this,Xt,!0);r(this,vt,0);i(this,Jt,e),i(this,v,s),this.canvas=n,i(this,wt,o),i(this,B,a),this.maxQuantity=20}panY(e){i(this,Xt,!1);const s=t(this,B)/(t(this,lt)-t(this,A)),n=e/s;i(this,vt,t(this,vt)+n)}zoomY(e){const l=.001+.009000000000000001*e,c=.001+(.01-.001)*e;i(this,At,Math.round((1-l)*1e4)/1e4),i(this,Vt,Math.round((1+c)*1e4)/1e4)}resetZoomAndPan(){i(this,Xt,!0),i(this,At,.997),i(this,Vt,1.003),i(this,vt,0)}resetData(){i(this,Bt,null),i(this,ot,null),i(this,A,null),i(this,lt,null),i(this,Xt,!0)}updateData(e,s){const{k:{o:n,h:o,l:a,c:l}}=e;i(this,Bt,{openPrice:n,highPrice:o,lowPrice:a,closePrice:l});const{asks:c,bids:u}=s;i(this,ot,{asks:c,bids:u}),i(this,A,Math.min((Number(o)+Number(a))/2*t(this,At),a)+t(this,vt)),i(this,lt,Math.max((Number(o)+Number(a))/2*t(this,Vt),o)+t(this,vt)),this.drawStart()}drawStart(){t(this,v).clearRect(0,0,t(this,wt),t(this,B));const e=t(this,B)/(t(this,lt)-t(this,A)),{closePrice:s,openPrice:n}=t(this,Bt),o=Math.round(t(this,B)-(s-t(this,A))*e),a=Math.round(t(this,B)-(n-t(this,A))*e),l=o>a?"#C0504E":o<a?"#51CDA0":"#c8c8c8";if(this.drawTextAt(o,s,l),this.drawTextAt(t(this,B)-10,Math.round(t(this,A)),"#c8c8c8"),this.drawTextAt(15,Math.round(t(this,lt)),"#c8c8c8"),this.maxQuantity=20,t(this,ot).asks&&t(this,ot).bids){const c=q=>q.reduce((f,S)=>{const H=Math.round(S[0]/this.bucketSize)*this.bucketSize;return f[H]||(f[H]=0),f[H]+=parseFloat(S[1]),f},{}),u=c(t(this,ot).asks),d=c(t(this,ot).bids),z=[...Object.values(u),...Object.values(d)];this.maxQuantity=Math.max.apply(null,z),Object.entries(u).forEach(([q,f])=>{const S=Math.round(t(this,B)-(q-t(this,A))*e);this.drawLineAt(S,"#C0504E",f)}),Object.entries(d).forEach(([q,f])=>{const S=Math.round(t(this,B)-(q-t(this,A))*e);this.drawLineAt(S,"#51CDA0",f)})}t(this,v).font="10px monospace",t(this,v).fillStyle="#c8c8c8",t(this,v).fillText(Math.round(this.maxQuantity),t(this,wt)-40,40)}drawLineAt(e,s,n){const o=n/this.maxQuantity*(t(this,wt)-80);t(this,v).beginPath(),t(this,v).moveTo(80,e),t(this,v).lineTo(o+80,e),t(this,v).strokeStyle=s,t(this,v).lineWidth=1,t(this,v).stroke()}drawTextAt(e,s,n){t(this,v).font="12px monospace",t(this,v).fillStyle=n,t(this,v).fillText(s,10,e)}}Jt=new WeakMap,v=new WeakMap,wt=new WeakMap,B=new WeakMap,Bt=new WeakMap,ot=new WeakMap,A=new WeakMap,lt=new WeakMap,At=new WeakMap,Vt=new WeakMap,Xt=new WeakMap,vt=new WeakMap;var te,b,K,C,G,at,Zt,Nt,Yt,L,J,F;class Ce{constructor(e,s,n,o,a){r(this,te,void 0);r(this,b,void 0);r(this,K,void 0);r(this,C,void 0);r(this,G,[]);r(this,at,void 0);r(this,Zt,void 0);r(this,Nt,void 0);r(this,Yt,60);r(this,L,void 0);r(this,J,30);r(this,F,0);i(this,te,e),i(this,b,s),this.canvas=n,i(this,K,o),i(this,C,a),i(this,L,Math.round(1*60*1e3/(t(this,J)*60*1e3)*(t(this,K)-t(this,Yt))))}panX(e){i(this,F,t(this,F)+e<0?0:t(this,F)+e)}zoomX(e){i(this,J,30+-20*e),i(this,L,Math.round(1*60*1e3/(t(this,J)*60*1e3)*(t(this,K)-t(this,Yt))))}resetZoomAndPan(){i(this,F,0),i(this,J,30),i(this,L,Math.round(1*60*1e3/(t(this,J)*60*1e3)*(t(this,K)-t(this,Yt))))}resetData(){i(this,G,[]),i(this,at,null),i(this,Zt,null),i(this,Nt,null),i(this,F,0)}updateData(e){const{k:{t:s,T:n,v:o,V:a}}=e,l=o-a;i(this,Nt,Math.round(t(this,G).reduce((c,u)=>Math.max(c,u.buyVolume,u.sellVolume),Math.max(a,l)))),t(this,Zt)!==s&&(t(this,at)&&(t(this,G).push(t(this,at)),t(this,G).length>60&&t(this,G).shift()),i(this,Zt,s)),i(this,at,{startTime:s,endTime:n,buyVolume:a,sellVolume:l}),this.drawStart()}drawStart(){if(t(this,b).clearRect(0,0,t(this,K),t(this,C)),t(this,G).length>0){const e=t(this,at).startTime-t(this,J)*60*1e3+t(this,F);t(this,G).forEach((s,n)=>{const o=Math.round((s.startTime-e)/(t(this,J)*60*1e3)*(t(this,K)-t(this,L)));this.drawDataPoint(s,o+t(this,F))})}this.drawDataPoint(t(this,at),Math.round(t(this,K)-t(this,L))+t(this,F))}drawDataPoint(e,s){const n=(t(this,C)-20)/t(this,Nt),o=Math.max(0,Math.min(t(this,C)-20,Math.round(t(this,C)-20-e.buyVolume*n))),a=Math.max(0,Math.min(t(this,C)-20,Math.round(t(this,C)-20-e.sellVolume*n)));t(this,b).beginPath(),t(this,b).moveTo(s,0),t(this,b).lineTo(s,t(this,C)-20),t(this,b).strokeStyle="rgba(200, 200, 200, 0.4)",t(this,b).lineWidth=1,t(this,b).stroke(),this.drawTimeLabel(s,e.startTime),this.drawKlineAt(s+t(this,L)/2+t(this,L)/8,o,"#51CDA0"),this.drawKlineAt(s+t(this,L)/2-t(this,L)/8,a,"#C0504E")}drawKlineAt(e,s,n){t(this,b).beginPath(),t(this,b).moveTo(e,t(this,C)-20),t(this,b).lineTo(e,s),t(this,b).strokeStyle=n,t(this,b).lineWidth=t(this,L)/6,t(this,b).stroke()}drawTimeLabel(e,s){const n=new Date(s),o=n.getHours().toString().padStart(2,"0")+":"+n.getMinutes().toString().padStart(2,"0");t(this,b).font="10px monospace",t(this,b).fillStyle="#c8c8c8",t(this,b).fillText(o,e,t(this,C)-5)}}te=new WeakMap,b=new WeakMap,K=new WeakMap,C=new WeakMap,G=new WeakMap,at=new WeakMap,Zt=new WeakMap,Nt=new WeakMap,Yt=new WeakMap,L=new WeakMap,J=new WeakMap,F=new WeakMap;async function be(){let e=Date.now()-25*60*60*1e3,s=e+60*60*1e3,n={};const[o,a]=await Promise.all([ze(),Ee()]),l=Object.keys(o).filter(d=>!["BTCSTUSDT","CVCUSDT","DOGEUSDC","COCOSUSDT","BNBBTC","ETHBTC","RAYUSDT","HNTUSDT","SCUSDT","WIFUSDT","BTSUSDT","TOMOUSDT","FTTUSDT","SRMUSDT"].includes(d)&&!d.includes("_")),c=l.map(d=>Le(d,e,s)),u=await Promise.all(c);return l.forEach((d,z)=>{a.hasOwnProperty(d)&&(n[d]={...o[d],...a[d],...u[z]})}),n}async function Le(h,e,s){let n;try{n=await Pe(h);const a=await(await fetch(`https://fapi.binance.com/futures/data/openInterestHist?symbol=${h}&period=30m&limit=1&startTime=${e}&endTime=${s}`)).json(),l=Math.round(a[0].sumOpenInterest),c=Math.round((n-l)/l*1e4)/100;return{open_interest:n,OI_24hrChange:c}}catch{return{open_interest:n,OI_24hrChange:NaN}}}async function Pe(h){try{const s=await(await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${h}`)).json();return Number(s.openInterest)}catch(e){return console.log(e,h),NaN}}async function ze(){let h={};const s=await(await fetch("https://fapi.binance.com/fapi/v1/premiumIndex")).json();for(let n of s){let o=n.symbol,a=parseFloat(n.lastFundingRate)*100,l=parseFloat(n.markPrice);h[o]={funding_rate:parseFloat(a.toFixed(3)),mark_price:Math.round(l*1e4)/1e4}}return h}async function Ee(){let h={};const s=await(await fetch("https://fapi.binance.com/fapi/v1/ticker/24hr")).json();for(let n of s){let o=n.symbol,a=n.quoteVolume,l=n.priceChangePercent;h[o]={change:Number(l),volume:Math.round(a)}}return h}var ct,dt,Ut,P,Ft;class Ie{constructor(){r(this,ct,void 0);r(this,dt,[]);r(this,Ut,[]);r(this,P,void 0);r(this,Ft,!0);U(this,"last_update_id");U(this,"order_book");console.log("Initializing WebSocketService")}createWebSocket(e,s){t(this,ct)&&t(this,ct).readyState===1&&(console.log("Closing existing websocket connection for symbol:",t(this,P).toUpperCase()),this.order_book.shouldRefresh=!1,t(this,ct).close(),i(this,Ft,!0),this.order_book=null,i(this,dt,[])),console.log("Creating websocket connection for symbol:",e),i(this,P,e.toLowerCase()),oe(t(this,P)).then(n=>{i(this,ct,new WebSocket(`wss://fstream.binance.com/stream?streams=${t(this,P)}@aggTrade/${t(this,P)}@depth@100ms/${t(this,P)}@kline_1m`)),this.setupEventListeners(t(this,ct),s),this.last_update_id=n.lastUpdateId,this.order_book=new Oe(t(this,P),n.bids,n.asks)}).catch(n=>{console.error("Error initializing the order book:",n)})}setupEventListeners(e,s){e.addEventListener("open",()=>{this.order_book.refresh_order_book(t(this,P)),console.log("New WebSocket connection opened")}),e.addEventListener("close",()=>{console.log("Previous WebSocket connection was closed")});let n=!1;e.addEventListener("message",async o=>{let a=JSON.parse(o.data);if(a.stream.endsWith("@aggTrade")){let l=a.data;t(this,dt).push({x:l.T,y:parseFloat(l.p),q:parseFloat(l.q),m:l.m})}else if(a.stream.endsWith("@depth@100ms")){if(n){console.log("isHandlingDepth:",n);return}n=!0,await this.handleDepth(a.data),n=!1}else a.stream.endsWith("@kline_1m")&&(i(this,Ut,a.data),s({kline:t(this,Ut),depth:this.order_book.order_book,tradesBuffer:t(this,dt)}),i(this,dt,[]))})}async handleDepth(e){let s=e.u,n=e.U,o=e.pu;if(s<this.last_update_id){console.log("finalUpdateId < last_update_id",s,this.last_update_id);return}if(t(this,Ft))if(n<=this.last_update_id&&this.last_update_id<=s)console.log("First processed event succeeded"),i(this,Ft,!1);else{await this.reinitializeOrderBook(t(this,P));return}else if(o!=this.last_update_id){await this.reinitializeOrderBook(t(this,P));return}await this.order_book.update_order_book(e.b,e.a),this.last_update_id=s}async reinitializeOrderBook(e){console.log("Out of sync, reinitializing order book...");const s=await oe(e);this.last_update_id=s.lastUpdateId,this.order_book.order_book=this.order_book.initialize_order_book(s.bids,s.asks),i(this,dt,[])}}ct=new WeakMap,dt=new WeakMap,Ut=new WeakMap,P=new WeakMap,Ft=new WeakMap;class Oe{constructor(e,s,n){U(this,"currentSymbol");U(this,"order_book");U(this,"shouldRefresh",!0);console.log("initializing new OrderBook class"),this.currentSymbol=e,this.order_book=this.initialize_order_book(s,n)}initialize_order_book(e,s){let n=e.map(a=>a.map(Number)),o=s.map(a=>a.map(Number));return{bids:n,asks:o}}async refresh_order_book(e){let s=new AbortController,n=setInterval(async()=>{if(!this.shouldRefresh||e!==this.currentSymbol)clearInterval(n),s.abort();else{s=new AbortController;try{let o=await oe(e,{signal:s.signal});this.order_book=this.initialize_order_book(o.bids,o.asks)}catch(o){o.name==="AbortError"?console.log("Fetch operation aborted"):console.error("Error fetching order book:",o)}}},6e3)}async update_order_book(e,s){let n=e.map(a=>a.map(Number)),o=s.map(a=>a.map(Number));[this.order_book.bids,this.order_book.asks]=await this.prepare_order_book(this.order_book.bids,this.order_book.asks,n,o)}async prepare_order_book(e,s,n,o){try{const a=new Map([...e,...n].filter(d=>d[0]>=e[e.length-1][0])),l=new Map([...s,...o].filter(d=>d[0]<=s[s.length-1][0]));let c=Array.from(a.entries()).filter(d=>d[1]!==0).sort((d,z)=>z[0]-d[0]),u=Array.from(l.entries()).filter(d=>d[1]!==0).sort((d,z)=>d[0]-z[0]);return c[0][0]>=u[0][0]&&(c=c.filter(d=>d[0]<n[n.length-1][0]),u=u.filter(d=>d[0]>o[0][0]),console.log("Error: bids[0] >= asks[0], rehandled to: ",c[0][0],u[0][0])),[c,u]}catch(a){return console.error("Error preparing order book:",a),[n,o]}}}async function oe(h){return await(await fetch(`https://fapi.binance.com/fapi/v1/depth?symbol=${h}&limit=500`)).json()}const se=["btn1","btn2","btn3","btn4"],Be=["tickers-menu","menu2","menu3","settings-menu"],Ae=[ge,Ne,Ze,Ye];for(let h=0;h<se.length;h++){const e=document.getElementById(se[h]);e.addEventListener("click",Ae[h]),e.addEventListener("click",function(){re(se[h],Be[h])})}const de=document.getElementById("tickers-menu"),ue=document.getElementById("settings-menu");let he=document.getElementById("ticker-search"),$t;he.addEventListener("keyup",function(){$t=this.value.toLowerCase();let h=document.querySelectorAll("#ticker-table tbody tr");for(let e of h)e.cells[0].textContent.toLowerCase().includes($t)?e.style.display="":e.style.display="none"});function Ve(h){Qe(h),console.log("canvas was started with symbol: "+h),he.value="",$t="";let e=document.querySelectorAll("#ticker-table tbody tr");for(let s of e)s.style.display="";ge()}function Xe(){const h=new Date,e=h.getHours().toString().padStart(2,"0"),s=h.getMinutes().toString().padStart(2,"0"),n=h.getSeconds().toString().padStart(2,"0");return e+":"+s+":"+n}function ye(){const h=document.getElementById("tickers-update-info");h.textContent="Last updated at "+Xe()}window.onload=function(){be().then(h=>{we(h),ye()})};window.addEventListener("resize",function(){console.log("resize")});function ge(){he.value="",$t="";let h=document.querySelectorAll("#ticker-table tbody tr");for(let e of h)e.style.display="";de.style.display=de.style.display==="none"?"block":"none",re("btn1","tickers-menu")}function Ze(){console.log("show menu")}function Ne(){}function Ye(){ue.style.display=ue.style.display==="none"?"block":"none",re("btn4","settings-menu")}function re(h,e){const s=document.getElementById(e),n=document.getElementById(h);(h==="btn1"||h==="btn4")&&(s.style.display==="block"?n.classList.add("active"):n.classList.remove("active"))}const ie=document.getElementById("tickers-update-btn");ie.addEventListener("click",function(){ie.disabled=!0,be().then(h=>{we(h),ye(),ie.disabled=!1})});function me(h){return h>=1e9?(h/1e9).toFixed(2)+"b":h>=1e6?(h/1e6).toFixed(2)+"m":h>=1e3?(h/1e3).toFixed(2)+"k":h}function ne(h,e,s){let n;return e==="mark_price"?h>10?n=Math.round(h*100)/100:n=Math.round(h*1e4)/1e4:e==="volume"?(n=me(h),n="$"+n):e==="open_interest"&&(n=me(h*s),n="$"+n),n}function we(h){let e=document.querySelector("#tickers-menu table tbody");e.innerHTML="";let s=Object.entries(h);s.sort(([,n],[,o])=>o.volume-n.volume);for(let n=0;n<s.length;n++){let[o,a]=s[n],l;n<e.rows.length?l=e.rows[n]:(l=e.insertRow(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell(),l.insertCell()),l.classList.add("table-row"),l.cells[0].textContent=o,l.cells[1].textContent=ne(a.mark_price,"mark_price",a.mark_price),l.cells[2].textContent=(Math.round(a.change*100)/100).toFixed(2)+"%",l.cells[3].textContent=a.funding_rate+"%",l.cells[4].textContent=ne(a.open_interest,"open_interest",a.mark_price),l.cells[5].textContent=a.OI_24hrChange+"%",l.cells[6].textContent=ne(a.volume,"volume",a.mark_price);const c=Math.min(Math.abs(a.change/100),1),u=Math.max(Math.abs(a.funding_rate*50),.2);a.change<0?l.style.backgroundColor="rgba(192, 80, 78, "+c*1.5+")":l.style.backgroundColor="rgba(81, 205, 160, "+c+")",a.funding_rate>0?l.cells[3].style.color="rgba(212, 80, 78, "+u*1.5+")":l.cells[3].style.color="rgba(81, 246, 160, "+u*1.5+")",l.addEventListener("click",function(){Ve(o)})}}let Wt=document.createElement("canvas");Wt.id="canvas1";Wt.style.position="absolute";Wt.style.left="0px";Wt.style.top="0px";document.body.appendChild(Wt);let V=document.querySelector("#canvas1"),Fe=V.getContext("2d");V.width=window.innerWidth*.9;V.height=window.innerHeight*.9;let ee=document.createElement("canvas");ee.id="canvas2";ee.style.position="absolute";ee.style.left=V.width+"px";document.body.appendChild(ee);let kt=document.querySelector("#canvas2"),qe=kt.getContext("2d");kt.width=window.innerWidth*.1;kt.height=window.innerHeight*.9;let ve=V.height;V.height=ve-window.innerHeight*.1;kt.height=ve-window.innerHeight*.1;let Qt=document.createElement("canvas");Qt.id="canvas4";Qt.style.position="absolute";Qt.style.left="0px";Qt.style.top=V.height+"px";document.body.appendChild(Qt);let St=document.querySelector("#canvas4"),He=St.getContext("2d");St.width=window.innerWidth*.9;St.height=window.innerHeight*.1;let jt=document.createElement("canvas");jt.id="canvas3";jt.style.position="absolute";jt.style.left="0px";jt.style.top=V.height+St.height+"px";document.body.appendChild(jt);let _t=document.querySelector("#canvas3"),Ue=_t.getContext("2d");_t.width=V.width;_t.height=window.innerHeight*.1;const We=new Ie,pe=new Me(Fe,V,V.width,V.height,He,St,St.width,St.height,qe,kt,kt.width,kt.height,Ue,_t,_t.width,_t.height);function Qe(h){je(h).then(e=>{We.createWebSocket(h,s=>pe.updateData(s)),pe.startNew(h,e),document.querySelector("#ticksize-select").dispatchEvent(new Event("change"))})}async function je(h){let n=(await(await fetch("https://fapi.binance.com/fapi/v1/exchangeInfo")).json()).symbols.find(o=>o.symbol===h);return n?n.filters[0].tickSize:null}
